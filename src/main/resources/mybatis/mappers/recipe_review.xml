<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.recipeReview">

	<resultMap type="recipeReviewVO" id="review">
		<id property="no" column="no"/>
		<result property="id" column="id"/>
		<result property="recipeNo" column="recipe_no"/>
		<result property="pictures" column="pictures"/>
		<result property="contents" column="contents"/>
		<result property="rating" column="rating"/>
		<result property="postDate" column="post_date"/>
		
		<association property="memberVO" javaType="memberVO">
			<id property="id" column="id"/>
			<result property="name" column="name"/>
			<result property="nickname" column="nickname"/>
			<result property="phone" column="phone"/>
			<result property="zipcode" column="zipcode"/>
			<result property="address1" column="address1"/>
			<result property="address2" column="address2"/>
			<result property="profile" column="profile"/>
			<result property="joinDate" column="join_date"/>
		</association>
	</resultMap>
	
	<select id="selectReviewsByRecipeNo" parameterType="recipeReviewVO" resultMap="review">
		<![CDATA[
			SELECT r.*, m.nickname, m.profile
			FROM recipe_review r
			JOIN member m ON r.id=m.id
        ]]>
        <where>
        	recipe_no=#{recipeNo}
        </where>
		<![CDATA[
			ORDER BY r.post_date DESC
        ]]>
	</select>
	
	<select id="selectReviewCount" parameterType="java.util.Map" resultType="int">
		<![CDATA[
			SELECT COUNT(*) FROM recipe_review
        ]]>
        <where>
        	id=#{id} AND recipe_no=#{recipeNo}
        </where>
	</select>
	
	<insert id="insertReview" parameterType="recipeReviewVO">
		<![CDATA[
			INSERT INTO recipe_review(id, recipe_no, pictures, contents, rating, post_date) 
			VALUES(#{id}, #{recipeNo}, #{pictures}, #{contents}, #{rating}, CURRENT_TIMESTAMP)
        ]]>
	</insert>
</mapper>